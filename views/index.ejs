<% include header.ejs %>
<% include nav.ejs %>
<div class="ui container">
    <h1>All Posts</h1>
    <div class="ui masonry grid">
        <% for(var i = 0; i < posts.length; i++){ %>
        <div class="column">
            <div class="ui fluid card">
                <div class="image">
                    <image src="<%= posts[i].image %>" onError="this.onerror=null; this.src='https://errorcodelist.com/wp-content/uploads/2016/09/error-triangle_318-27867.jpg'">
                </div>
                <div class="content">
                    <p><%= posts[i].comment %></p>
                    <p>by <a href="/user/<%= posts[i].userId %>"><%= posts[i].username %></a></p>
                </div>
                <% if(authenticated){ %>
                    <div class="extra content">
                        <a class="ui button basic red liked" id="<%= posts[i]._id %>"><%= posts[i].likedUsers.length %> Likes</a>
                    </div>
                <% } %>
            </div>
        </div>
        <% } %>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function(){
        $('.liked').click(function(){
            $.ajax({
                crossOrigin: true,
                url: '/user',
                type: 'POST',
                data:{
                    post: $(this).attr("id")
                },
                success: function(){
                    location.reload();
                },
                error: function(err){
                    alert(JSON.stringify(err));
                },
                complete: function(){
                    location.reload();
                }
            });
        })
        
    })
</script>